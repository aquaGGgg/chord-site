{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{jwtDecode}from'jwt-decode';// ✅ исправленный импорт\nimport authService from'../services/authService';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const navigate=useNavigate();const[user,setUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token')||null);const[refreshToken,setRefreshToken]=useState(localStorage.getItem('refreshToken')||null);useEffect(()=>{if(token){try{const decoded=jwtDecode(token);// ✅ исправленное имя\nconst userData={id:decoded.id,email:decoded.email,username:decoded.username||decoded.email,role:decoded.role||'User'};setUser(userData);}catch(error){console.error(\"Ошибка при декодировании токена:\",error);logout();}}},[token]);const setAuthData=(accessToken,refreshToken,userData)=>{setToken(accessToken);setRefreshToken(refreshToken);setUser(userData);localStorage.setItem('token',accessToken);localStorage.setItem('refreshToken',refreshToken);};const login=async(email,password)=>{try{if(email==='admin'&&password==='admin'){const adminUser={id:1,email,username:'Administrator',role:'Admin'};setAuthData('fake-admin-token','fake-refresh-token',adminUser);navigate('/profile');return;}const data=await authService.login(email,password);const decoded=jwtDecode(data.token||data.accessToken);const userData={id:decoded.id,email:decoded.email,username:decoded.username||email,role:decoded.role||'User'};setAuthData(data.token||data.accessToken,data.refreshToken,userData);navigate('/profile');}catch(error){console.error(\"Ошибка при входе:\",error);throw error;}};const register=async(username,email,password)=>{try{const data=await authService.register(username,email,password);const decoded=jwtDecode(data.token||data.accessToken);const userData={id:decoded.id,email:decoded.email,username:decoded.username||email,role:decoded.role||'User'};setAuthData(data.token||data.accessToken,data.refreshToken,userData);navigate('/profile');}catch(error){console.error(\"Ошибка при регистрации:\",error);throw error;}};const refreshAccessToken=async()=>{if(!refreshToken)return;try{const data=await authService.refreshToken(refreshToken);const newAccessToken=data.token||data.accessToken;setToken(newAccessToken);localStorage.setItem('token',newAccessToken);}catch(error){console.error(\"Ошибка при обновлении токена:\",error);logout();}};const logout=()=>{setToken(null);setRefreshToken(null);setUser(null);localStorage.removeItem('token');localStorage.removeItem('refreshToken');navigate('/login');};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,token,refreshToken,login,register,logout,refreshAccessToken},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","useNavigate","jwtDecode","authService","jsx","_jsx","AuthContext","AuthProvider","_ref","children","navigate","user","setUser","token","setToken","localStorage","getItem","refreshToken","setRefreshToken","decoded","userData","id","email","username","role","error","console","logout","setAuthData","accessToken","setItem","login","password","adminUser","data","register","refreshAccessToken","newAccessToken","removeItem","Provider","value"],"sources":["E:/Project/front/chord-site/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { jwtDecode } from 'jwt-decode'; // ✅ исправленный импорт\r\nimport authService from '../services/authService';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const navigate = useNavigate();\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(localStorage.getItem('token') || null);\r\n  const [refreshToken, setRefreshToken] = useState(localStorage.getItem('refreshToken') || null);\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      try {\r\n        const decoded = jwtDecode(token); // ✅ исправленное имя\r\n        const userData = {\r\n          id: decoded.id,\r\n          email: decoded.email,\r\n          username: decoded.username || decoded.email,\r\n          role: decoded.role || 'User'\r\n        };\r\n        setUser(userData);\r\n      } catch (error) {\r\n        console.error(\"Ошибка при декодировании токена:\", error);\r\n        logout();\r\n      }\r\n    }\r\n  }, [token]);\r\n\r\n  const setAuthData = (accessToken, refreshToken, userData) => {\r\n    setToken(accessToken);\r\n    setRefreshToken(refreshToken);\r\n    setUser(userData);\r\n\r\n    localStorage.setItem('token', accessToken);\r\n    localStorage.setItem('refreshToken', refreshToken);\r\n  };\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      if (email === 'admin' && password === 'admin') {\r\n        const adminUser = { id: 1, email, username: 'Administrator', role: 'Admin' };\r\n        setAuthData('fake-admin-token', 'fake-refresh-token', adminUser);\r\n        navigate('/profile');\r\n        return;\r\n      }\r\n\r\n      const data = await authService.login(email, password);\r\n      const decoded = jwtDecode(data.token || data.accessToken);\r\n      const userData = {\r\n        id: decoded.id,\r\n        email: decoded.email,\r\n        username: decoded.username || email,\r\n        role: decoded.role || 'User'\r\n      };\r\n\r\n      setAuthData(data.token || data.accessToken, data.refreshToken, userData);\r\n      navigate('/profile');\r\n    } catch (error) {\r\n      console.error(\"Ошибка при входе:\", error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const register = async (username, email, password) => {\r\n    try {\r\n      const data = await authService.register(username, email, password);\r\n      const decoded = jwtDecode(data.token || data.accessToken);\r\n      const userData = {\r\n        id: decoded.id,\r\n        email: decoded.email,\r\n        username: decoded.username || email,\r\n        role: decoded.role || 'User'\r\n      };\r\n\r\n      setAuthData(data.token || data.accessToken, data.refreshToken, userData);\r\n      navigate('/profile');\r\n    } catch (error) {\r\n      console.error(\"Ошибка при регистрации:\", error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const refreshAccessToken = async () => {\r\n    if (!refreshToken) return;\r\n\r\n    try {\r\n      const data = await authService.refreshToken(refreshToken);\r\n      const newAccessToken = data.token || data.accessToken;\r\n      setToken(newAccessToken);\r\n      localStorage.setItem('token', newAccessToken);\r\n    } catch (error) {\r\n      console.error(\"Ошибка при обновлении токена:\", error);\r\n      logout();\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    setToken(null);\r\n    setRefreshToken(null);\r\n    setUser(null);\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('refreshToken');\r\n    navigate('/login');\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{ user, token, refreshToken, login, register, logout, refreshAccessToken }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}