{"ast":null,"code":"\"use strict\";\n\n// Licensed to the .NET Foundation under one or more agreements.\n// The .NET Foundation licenses this file to you under the MIT license.\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.XhrHttpClient = void 0;\nconst Errors_1 = require(\"./Errors\");\nconst HttpClient_1 = require(\"./HttpClient\");\nconst ILogger_1 = require(\"./ILogger\");\nconst Utils_1 = require(\"./Utils\");\nclass XhrHttpClient extends HttpClient_1.HttpClient {\n  constructor(logger) {\n    super();\n    this._logger = logger;\n  }\n  /** @inheritDoc */\n  send(request) {\n    // Check that abort was not signaled before calling send\n    if (request.abortSignal && request.abortSignal.aborted) {\n      return Promise.reject(new Errors_1.AbortError());\n    }\n    if (!request.method) {\n      return Promise.reject(new Error(\"No method defined.\"));\n    }\n    if (!request.url) {\n      return Promise.reject(new Error(\"No url defined.\"));\n    }\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open(request.method, request.url, true);\n      xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\n      xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n      if (request.content === \"\") {\n        request.content = undefined;\n      }\n      if (request.content) {\n        // Explicitly setting the Content-Type header for React Native on Android platform.\n        if ((0, Utils_1.isArrayBuffer)(request.content)) {\n          xhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\n        } else {\n          xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\n        }\n      }\n      const headers = request.headers;\n      if (headers) {\n        Object.keys(headers).forEach(header => {\n          xhr.setRequestHeader(header, headers[header]);\n        });\n      }\n      if (request.responseType) {\n        xhr.responseType = request.responseType;\n      }\n      if (request.abortSignal) {\n        request.abortSignal.onabort = () => {\n          xhr.abort();\n          reject(new Errors_1.AbortError());\n        };\n      }\n      if (request.timeout) {\n        xhr.timeout = request.timeout;\n      }\n      xhr.onload = () => {\n        if (request.abortSignal) {\n          request.abortSignal.onabort = null;\n        }\n        if (xhr.status >= 200 && xhr.status < 300) {\n          resolve(new HttpClient_1.HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\n        } else {\n          reject(new Errors_1.HttpError(xhr.response || xhr.responseText || xhr.statusText, xhr.status));\n        }\n      };\n      xhr.onerror = () => {\n        this._logger.log(ILogger_1.LogLevel.Warning, `Error from HTTP request. ${xhr.status}: ${xhr.statusText}.`);\n        reject(new Errors_1.HttpError(xhr.statusText, xhr.status));\n      };\n      xhr.ontimeout = () => {\n        this._logger.log(ILogger_1.LogLevel.Warning, `Timeout from HTTP request.`);\n        reject(new Errors_1.TimeoutError());\n      };\n      xhr.send(request.content);\n    });\n  }\n}\nexports.XhrHttpClient = XhrHttpClient;","map":{"version":3,"names":["Errors_1","require","HttpClient_1","ILogger_1","Utils_1","XhrHttpClient","HttpClient","constructor","logger","_logger","send","request","abortSignal","aborted","Promise","reject","AbortError","method","Error","url","resolve","xhr","XMLHttpRequest","open","withCredentials","undefined","setRequestHeader","content","isArrayBuffer","headers","Object","keys","forEach","header","responseType","onabort","abort","timeout","onload","status","HttpResponse","statusText","response","responseText","HttpError","onerror","log","LogLevel","Warning","ontimeout","TimeoutError","exports"],"sources":["M:\\chord-site\\node_modules\\@microsoft\\signalr\\src\\XhrHttpClient.ts"],"sourcesContent":["// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpRequest, HttpResponse } from \"./HttpClient\";\r\nimport { ILogger, LogLevel } from \"./ILogger\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n\r\nexport class XhrHttpClient extends HttpClient {\r\n    private readonly _logger: ILogger;\r\n\r\n    public constructor(logger: ILogger) {\r\n        super();\r\n        this._logger = logger;\r\n    }\r\n\r\n    /** @inheritDoc */\r\n    public send(request: HttpRequest): Promise<HttpResponse> {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n\r\n        return new Promise<HttpResponse>((resolve, reject) => {\r\n            const xhr = new XMLHttpRequest();\r\n\r\n            xhr.open(request.method!, request.url!, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            if (request.content === \"\") {\r\n                request.content = undefined;\r\n            }\r\n            if (request.content) {\r\n                // Explicitly setting the Content-Type header for React Native on Android platform.\r\n                if (isArrayBuffer(request.content)) {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\r\n                } else {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n                }\r\n            }\r\n\r\n            const headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach((header) => {\r\n                        xhr.setRequestHeader(header, headers[header]);\r\n                    });\r\n            }\r\n\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = () => {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n\r\n            xhr.onload = () => {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                } else {\r\n                    reject(new HttpError(xhr.response || xhr.responseText || xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n\r\n            xhr.onerror = () => {\r\n                this._logger.log(LogLevel.Warning, `Error from HTTP request. ${xhr.status}: ${xhr.statusText}.`);\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n\r\n            xhr.ontimeout = () => {\r\n                this._logger.log(LogLevel.Warning, `Timeout from HTTP request.`);\r\n                reject(new TimeoutError());\r\n            };\r\n\r\n            xhr.send(request.content);\r\n        });\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}